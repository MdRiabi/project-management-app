<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TekUpFlow{% endblock %}</title>

    {# Tailwind CSS #}
    <script src="https://cdn.tailwindcss.com"></script>

    {# Font Awesome Icons #}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    {# Google Fonts #}
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body {% block body_attributes %}class="bg-gray-100 dark:bg-gray-900"{% endblock %}>

    {# ---------------------------------------------------- #}
    {# SIDEBAR (MENU LATÉRAL) #}
    {# ---------------------------------------------------- #}
    {% include 'components/_sidebar_admin.html.twig' %}



    <div class="lg:pl-64 flex flex-col">
        <script>
            // Toggle sidebar collapsed/expanded without hiding it; keep toggle button visible
            document.addEventListener('DOMContentLoaded', function () {
                const toggleBtn = document.getElementById('sidebarToggle');
                const sidebar = document.getElementById('admin-sidebar');
                const sidebarTitle = document.getElementById('sidebar-title');
                if (!toggleBtn || !sidebar) return;

                // Ensure it's not hidden so it can always be expanded back
                sidebar.classList.remove('hidden', '-translate-x-full');
                sidebar.classList.add('lg:block');

                const collapsedClass = 'sidebar-collapsed';

                toggleBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    sidebar.classList.toggle(collapsedClass);
                    if (sidebarTitle) {
                        // In collapsed state, hide title; show in expanded
                        if (sidebar.classList.contains(collapsedClass)) {
                            sidebarTitle.classList.add('hidden');
                        } else {
                            sidebarTitle.classList.remove('hidden');
                        }
                    }
                });
            });
        </script>

        {# ---------------------------------------------------- #}
        {# HEADER / TOPBAR #}
        {# ---------------------------------------------------- #}
        {% include 'components/_topbar_admin.html.twig' %}

        {# ---------------------------------------------------- #}
        {# CONTENU PRINCIPAL DU DASHBOARD #}
        {# ---------------------------------------------------- #}
        <main class="flex-1 p-6">



            {# GRID PRINCIPALE #}
            <div class="grid grid-cols-12 gap-6">

                {# COLUMN 1 (ANALYSE DE PROJET) - Colspan 4 #}
                <div class="col-span-12 lg:col-span-4 space-y-6">

                    {# PROJECT ANALYSIS HEADER #}
                    <div class="p-6 rounded-xl shadow-lg dark:bg-gray-800 bg-cover bg-center" style="background-image: url('placeholder-bg.svg'); background-color: #3f3570;">
                        <div class="flex items-center text-white mb-4">
                            <i class="fas fa-bolt text-xl mr-3"></i>
                            <h2 class="text-xl font-bold">PROJECT ANALYSIS</h2>
                        </div>
                        <p class="text-gray-300">Welcome to dashboard, you can manage all your project activities here</p>
                    </div>

                    {# STATISTIQUES DES PROJETS #}
                    <div class="grid grid-cols-2 gap-4">
                        {# Total Projects #}
                        <div class="p-5 rounded-xl dark:bg-gray-800 shadow-md">
                            <i class="fas fa-briefcase text-blue-500 mb-2"></i>
                            <p class="text-gray-400 text-sm">Total Projects</p>
                            <h3 class="text-3xl font-extrabold text-white">34,876 <span class="text-xs text-green-500 ml-1">10.2%</span></h3>
                        </div>
                        {# Completed Projects #}
                        <div class="p-5 rounded-xl dark:bg-gray-800 shadow-md">
                            <i class="fas fa-thumbs-up text-pink-500 mb-2"></i>
                            <p class="text-gray-400 text-sm">Completed</p>
                            <h3 class="text-3xl font-extrabold text-white">26,231 <span class="text-xs text-red-500 ml-1">5.3%</span></h3>
                        </div>
                        {# Pending Projects (Risques) #}
                        <div class="p-5 rounded-xl dark:bg-gray-800 shadow-md">
                            <i class="fas fa-clock text-yellow-500 mb-2"></i>
                            <p class="text-gray-400 text-sm">Pending</p>
                            <h3 class="text-3xl font-extrabold text-white">8,645 <span class="text-xs text-green-500 ml-1">2.1%</span></h3>
                        </div>
                        {# New Projects #}
                        <div class="p-5 rounded-xl dark:bg-gray-800 shadow-md">
                            <i class="fas fa-folder-plus text-red-500 mb-2"></i>
                            <p class="text-gray-400 text-sm">New Projects</p>
                            <h3 class="text-3xl font-extrabold text-white">3,579 <span class="text-xs text-red-500 ml-1">7.8%</span></h3>
                        </div>
                    </div>
                </div>

                {# COLUMN 2 (GRAPHIQUES et ACTIVITÉ) - Colspan 8 #}
                <div class="col-span-12 lg:col-span-8 space-y-6">

                    {# PROJECT STATISTICS (GRAPHIQUE LIGNES) - Colspan 8 (dans cette colonne) #}
                    <div class="grid grid-cols-12 gap-6">
                        <div class="col-span-12 lg:col-span-7 p-6 rounded-xl dark:bg-gray-800 shadow-lg">
                            <h2 class="text-lg font-semibold text-white mb-4">PROJECT STATISTICS</h2>
                            <div class="h-64">
                                {# EMPLACEMENT DU GRAPHIQUE JS #}
                                <canvas id="project-stats-chart"></canvas>
                                {# NOTE: Vous devez ajouter le JS (Chart.js ou autre) dans le block javascript #}
                            </div>
                        </div>

                        {# TASK ACTIVITY (GRAPHIQUE DONUT) - Colspan 5 (dans cette colonne) #}
                        <div class="col-span-12 lg:col-span-5 p-6 rounded-xl dark:bg-gray-800 shadow-lg">
                            <h2 class="text-lg font-semibold text-white mb-4">TASK ACTIVITY</h2>
                            <div class="h-40 flex items-center justify-center">
                                {# EMPLACEMENT DU GRAPHIQUE JS DONUT #}
                                <canvas id="task-activity-chart"></canvas>
                            </div>
                            {# Liste des tâches pour ce bloc #}
                            <ul class="space-y-2 mt-4 text-sm">
                                <li class="text-white"><span class="text-blue-400">•</span> On Going Tasks: 1,754</li>
                                <li class="text-white"><span class="text-purple-400">•</span> Completed Tasks: 634</li>
                                <li class="text-white"><span class="text-green-400">•</span> To Do Tasks: 878</li>
                                <li class="text-white"><span class="text-yellow-400">•</span> Pending Tasks: 470</li>
                            </ul>
                        </div>
                    </div>

                    {# SECONDARY ROW (TO DO / TASK LIST) #}

                </div>

            </div>
        </main>
    </div>

{% block javascripts %}
    <script>
        // Counter animation
        function animateCounter(element, target, duration = 2000) {
            let start = 0;
            const increment = target / (duration / 16);
            const timer = setInterval(() => {
                start += increment;
                if (start >= target) {
                    element.textContent = target.toLocaleString();
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(start).toLocaleString();
                }
            }, 16);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const counters = document.querySelectorAll('.counter');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !entry.target.dataset.animated) {
                        const target = parseInt(entry.target.dataset.target);
                        animateCounter(entry.target, target);
                        entry.target.dataset.animated = 'true';
                    }
                });
            }, { threshold: 0.5 });

            counters.forEach(counter => observer.observe(counter));
        });
    </script>
{% endblock %}
</body>
</html>
